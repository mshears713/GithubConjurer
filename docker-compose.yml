# Orchard of Branches - Docker Compose Configuration
version: '3.8'

services:
  orchard:
    build:
      context: .
      dockerfile: Dockerfile
    container_name: orchard-of-branches
    environment:
      - DISPLAY=${DISPLAY}
      - NODE_ENV=development
    volumes:
      # Mount X11 socket for GUI
      - /tmp/.X11-unix:/tmp/.X11-unix:rw
      # Mount source code for development (optional, comment out for production)
      - ./src:/app/src
      # Preserve node_modules
      - node_modules:/app/node_modules
      # Mount user's .gitconfig for Git operations (optional)
      - ~/.gitconfig:/home/orcharduser/.gitconfig:ro
    network_mode: host
    ipc: host
    stdin_open: true
    tty: true
    # Security options for X11
    security_opt:
      - seccomp:unconfined
    # Grant access to host's X server
    devices:
      - /dev/dri:/dev/dri

volumes:
  node_modules:
